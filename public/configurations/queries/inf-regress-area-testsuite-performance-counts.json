{
    "id": "inf-regress-area-testsuite-performance-counts",
    "author": "Ryan Fredette",
    "service": "elasticsearch",
    "tabify":"testSuitePerformanceCounts",
    "query": {
      "index": "nuage_regress",
      "type": "nuage_doc_type",
      "body": {
        "sort": [
          { "time_regression_started" : {"order" : "desc"}}
        ],
        "size": 0,
        "query": {
          "bool": {
            "must": [
              {
                "range":{
                  "time_regression_submitted":{
                    "gte":"{{testsuiteTime}}",
                    "lte":"{{testsuiteTime}}||+1d",
                    "format":"epoch_millis"
                  }
                }
              }
            ],
            "filter": [
              {"term": { "testsuite": "{{testSuite}}"}}
            ],
            
            "must_not": [
              {
                  "bool": {
                      "minimum_should_match": 1,
                      "should": [
                          {
                              "match_phrase": {
                                  "testsuite": "Sanity"
                              }
                          },
                          {
                              "match_phrase": {
                                  "testsuite": "initial"
                              }
                          },
                          {
                              "match_phrase": {
                                  "testsuite": "final"
                              }
                          },
                          {
                              "match_phrase": {
                                  "testsuite": "finished"
                              }
                          }
                      ]
                  }
              }
          ]
          }
        },
        "_source": {
          "excludes": []
        },
        "aggs": {
          "testbed": {
            "terms": {
              "field": "testbed"
            },
            "aggs": {
              "result": {
                "terms": {
                  "field": "result"
                }
              }
            }
          }
        }
      }
    }
  }