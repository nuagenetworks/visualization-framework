{
    "id": "inf-testbed-failure",
    "title": "",
    "service": "elasticsearch",
    "query": {
      "index": "nuage_regress",
      "type": "nuage_doc_type",
      "body": {
        "size": 0,
        "query": {
          "bool": {
            "must": [
              {
                "range": {
                  "time_regression_started": {
                    "gte": "now-7d",
                    "lte": "now",
                    "format": "epoch_millis"
                  }
                }
              },
              {
                "term": {
                  "testcase": ""
                }
              },
              {
                "terms": {
                  "testsuite": [
                    "initial",
                    "sanity",
                    "Sanity"
                  ]
                }
              }
            ]
          }
        },
        "aggs": {
          "date_histo": {
            "date_histogram": {
              "field": "time_regression_started",
              "interval": "1d"
            },
            "aggs": {
              "failed_jobs": {
                "cardinality": {
                  "script": {
                    "inline": "doc['result'].value !=2 ? doc['job_id'].value : null"
                  }
                }
              },
              "total_jobs": {
                "cardinality": {
                  "field": "job_id"
                }
              },
              "failed_percentage": {
                "bucket_script": {
                  "buckets_path": {
                    "failed_jobs": "failed_jobs",
                    "total_jobs": "total_jobs"
                  },
                  "script": "params.failed_jobs/params.total_jobs * 100.0"
                }
              }
            }
          }
        }
      }
    }
  }